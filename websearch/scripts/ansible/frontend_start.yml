---
- name: Start frontend server
  hosts:
    - frontend
  vars:
    websearch_home_dir: "/local/websearch"
    java_home: "{{ websearch_home_dir }}/jdk1.7.0_11"
    tomcat_instance_home_dir: "{{ websearch_home_dir }}/tomcat-{{ socket }}"
    tomcat_http_port: "{{ 8080 + socket }}"
  tasks:
  - name: Remove log file
    file:
      path: "{{ tomcat_instance_home_dir }}/logs/catalina.out"
      state: absent
  - name: Start tomcat
    shell: "numactl --cpunodebind={{ socket }} {{ tomcat_instance_home_dir }}/bin/startup.sh"
    environment:
      JAVA_HOME: "{{ java_home }}"
    async: 10000 
    poll: 0
  - name: Wait for tomcat to start
    wait_for: port={{ tomcat_http_port }}